import{b as c,A as N,d as P,e as u,f as v,h as e,m as V,t as k,H as F,N as q,j as p,O as B,k as $,K as T,a as D,n as M,w as L,F as C,B as x,G as A,I as j,J as K,l as E}from"./index-97618aaf.js";import{a as Y,_ as I,b as J}from"./Modal-b92192f7.js";import{d as g}from"./dayjs.min-ea3b3170.js";import{_ as U}from"./FermentationInput-e09fa1f1.js";import{F as z}from"./FermentationSelect-af55ba98.js";import{u as G}from"./useAlarm-9f7e386b.js";import{c as O}from"./cloneDeep-496a588a.js";import"./menu-455b295a.js";import"./multiselect-adf77822.js";import"./plugin-vueexport-helper-c27b6911.js";const Q={class:"form-group"},W={class:"mg-b-10"},X={class:"text-danger"},Z={class:"invalid-feedback"},S={__name:"FermentationDatePicker",props:{modelValue:[String,Array],error:String,label:String,required:Boolean},emits:["update:modelValue"],setup(h,{emit:_}){const m=h,i=c(m.modelValue);return N(()=>m.modelValue,d=>{i.value=d}),(d,s)=>{const f=P("Datepicker");return u(),v("div",Q,[e("p",W,[V(k(h.label)+" ",1),F(e("span",X,"*",512),[[q,h.required]])]),p(f,B({modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=b=>i.value=b)},d.$attrs,{class:{"is-invalid":!$(T)(h.error)}}),null,16,["modelValue","class"]),e("div",Z,k(h.error),1)])}}},ee={class:"row"},te={class:"col-lg-6 col-sm-12"},ae={class:"col-lg-6 col-sm-12"},oe={key:0,class:"col-12"},le={class:"col-lg-6 col-sm-12"},se={class:"col-lg-6 col-sm-12"},ne={__name:"FormModal",setup(h,{expose:_}){const{alarms:m}=G(),i=c(null),d=c("create"),s=D(()=>{let n="";switch(d.value){case"create":n="新增專案資料";break;case"update":n="更新專案資料";break}return n}),f=D(()=>m.value.map(n=>n.targetDevice)),b={name:"",targetDevice:"",startTime:"",endTime:""},w=c([]),y=()=>O(b),a=c(y()),o=D(()=>g().isAfter(a.value.startTime));return _({show:(n,l)=>{d.value=n,a.value=y(),l&&(a.value=O(l)),w.value=[a.value.startTime,a.value.endTime],i.value.show()}}),(n,l)=>(u(),M(Y,{ref_key:"modalRef",ref:i,"dialog-class":"modal-content-demo",title:s.value},{footer:L(()=>[e("button",{href:"javascript:;",class:"btn btn-md btn-info",onClick:l[5]||(l[5]=r=>i.value.hide())}," 取消 "),e("button",{href:"javascript:;",class:"btn btn-md btn-danger",onClick:l[6]||(l[6]=r=>i.value.hide())}," 送出 ")]),default:L(()=>[e("div",ee,[e("div",te,[p(U,{modelValue:a.value.name,"onUpdate:modelValue":l[0]||(l[0]=r=>a.value.name=r),label:"專案名稱",required:"",placeholder:"請輸入專案名稱"},null,8,["modelValue"])]),e("div",ae,[p(z,{modelValue:a.value.targetDevice,"onUpdate:modelValue":l[1]||(l[1]=r=>a.value.targetDevice=r),options:f.value,label:"目標裝置",required:"",placeholder:"請輸入目標裝置"},null,8,["modelValue","options"])]),d.value==="create"||!o.value?(u(),v("div",oe,[p(S,{modelValue:w.value,"onUpdate:modelValue":l[2]||(l[2]=r=>w.value=r),range:"",label:"起始時間-結束時間","min-date":$(g)(),placeholder:"請選擇起訖時間",format:"yyyy/MM/dd HH:mm",required:""},null,8,["modelValue","min-date"])])):(u(),v(C,{key:1},[e("div",le,[p(U,{modelValue:a.value.startTime,"onUpdate:modelValue":l[3]||(l[3]=r=>a.value.startTime=r),label:"起始時間",disabled:""},null,8,["modelValue"])]),e("div",se,[p(S,{modelValue:a.value.endTime,"onUpdate:modelValue":l[4]||(l[4]=r=>a.value.endTime=r),"min-date":$(g)(),label:"結束時間",placeholder:"請選擇結束時間",format:"yyyy/MM/dd HH:mm",required:""},null,8,["modelValue","min-date"])])],64))])]),_:1},8,["title"]))}},re={class:"userlist-table"},ie={class:"table card-table table-striped table-vcenter text-nowrap mb-0"},de=["colspan"],ce={__name:"LogsModal",setup(h,{expose:_}){const m=c(null),i=c(""),d=c([]),s=c([]),f=(a="")=>{const o=a.toLocaleLowerCase();return o==="Temp".toLocaleLowerCase()?"⸰C":o==="Rpm".toLocaleLowerCase()?"rpm":o==="CO2".toLocaleLowerCase()?"PPM":o==="O2".toLocaleLowerCase()?"%":o==="Lux".toLocaleLowerCase()?"lux":o.includes("Pump".toLocaleLowerCase())&&o.includes("flow".toLocaleLowerCase())?"L":o.includes("RH".toLocaleLowerCase())?"%":""},b=a=>["Time".toLocaleLowerCase(),"Temp".toLocaleLowerCase(),"Rpm".toLocaleLowerCase(),"pH".toLocaleLowerCase(),"ORP".toLocaleLowerCase(),"CO2".toLocaleLowerCase(),"O2".toLocaleLowerCase(),"Lux".toLocaleLowerCase(),"RH".toLocaleLowerCase()].includes(a)?!0:!!(a.includes("Pump".toLocaleLowerCase())&&a.includes("flow".toLocaleLowerCase())),w=a=>{const o=a.split(/\r\n|\n/),t=o[0].split(",");let n=[];d.value=t.filter(r=>{if(b(r.toLocaleLowerCase()))return r});for(let r=1;r<o.length;r++){let R=o[r].split(",");if(R.length==t.length){let H=[];for(var l=0;l<t.length;l++)b(t[l].toLocaleLowerCase())&&H.push(`${R[l]}${f(t[l])}`);n.push(H)}}return n},y=async a=>{const t=await(await fetch(`Reform_${g(a).format("YYYYMMDD")}.csv`,{method:"get",headers:{"content-type":"text/csv;charset=UTF-8"}})).text();s.value=w(t)};return _({show:(a,o)=>{i.value=a,m.value.show(),y(o)}}),(a,o)=>(u(),M(Y,{ref_key:"modalRef",ref:m,title:i.value,"dialog-class":"modal-lg modal-dialog-scrollable"},{default:L(()=>[e("div",re,[e("table",ie,[e("thead",null,[e("tr",null,[(u(!0),v(C,null,x(d.value,t=>(u(),v("th",{key:t},k(t),1))),128))])]),e("tbody",null,[s.value.length>0?(u(!0),v(C,{key:0},x(s.value,t=>(u(),v("tr",{key:t},[(u(!0),v(C,null,x(t,n=>(u(),v("td",null,k(n),1))),256))]))),128)):(u(),v("td",{key:1,colspan:d.value.length,class:"text-center"}," 查無資料 ",8,de))])])])]),_:1},8,["title"]))}},ue={__name:"DeleteModal",setup(h,{expose:_}){const m=c(null),i=c("");return _({show:d=>{var s;i.value=d,(s=m.value)==null||s.show()}}),(d,s)=>(u(),M(Y,{ref_key:"modalRef",ref:m,"body-class":"text-center","dialog-class":"modal-dialog-centered",title:"刪除專案"},{footer:L(()=>[e("button",{href:"javascript:;",class:"btn btn-md btn-info",onClick:s[0]||(s[0]=f=>m.value.hide())}," 取消 "),e("button",{href:"javascript:;",class:"btn btn-md btn-danger",onClick:s[1]||(s[1]=f=>m.value.hide())}," 確定 ")]),default:L(()=>[V(" 確認是否刪除"+k(i.value)+" ",1)]),_:1},512))}},me={class:"row row-sm"},ve={class:"col-sm-12 col-md-12 col-lg-12 col-xl-12 grid-margin"},fe={class:"card custom-card"},pe={class:"card-header border-bottom-0 pb-0"},_e={class:"row"},be={class:"col-12"},he={class:"d-flex flex-column flex-lg-row justify-content-between"},ge={class:"input-group wd-lg-25p"},we={class:"input-group-append"},ye={class:"card-body"},Le=["onClick"],ke=e("i",{class:"fe fe-edit-2"},null,-1),Ce=[ke],$e=["onClick"],De=e("i",{class:"mdi mdi-database"},null,-1),xe=[De],Te=["onClick"],Ve=e("i",{class:"fe fe-trash"},null,-1),Me=[Ve],Ye="專案管理",Ae={__name:"index",setup(h){const _=A({keyword:""}),m=[{label:"專案名稱",key:"name"},{label:"目標裝置",key:"targetDevice"},{label:"起始時間",key:"startTime"},{label:"結束時間",key:"endTime"},{label:"操作",key:"action",tdClassName:"btn-list"}],i=c({total:10,size:10,page:1}),d=[{id:"1",name:"紀錄1",targetDevice:"醱酵槽1",startTime:"2023/10/16 00:00",endTime:g().add(2,"day").format("YYYY/MM/DD HH:mm")},{id:"2",name:"紀錄2",targetDevice:"離心機1",startTime:"2023/10/24 00:00",endTime:g().add(2,"day").format("YYYY/MM/DD HH:mm")},{id:"3",name:"紀錄3",targetDevice:"離心機1",startTime:g().add(1,"day").format("YYYY/MM/DD HH:mm"),endTime:g().add(2,"day").format("YYYY/MM/DD HH:mm")}],s=c(d),f=(a=1,o=10)=>{const t={..._,page:a,limit:o};T(t.keyword)?T(t.keyword)&&(s.value=d):s.value=s.value.filter(n=>n.name.includes(t.keyword)|n.targetDevice),i.value.total=s.value.length},b=c(null),w=c(null),y=c(null);return(a,o)=>(u(),v(C,null,[p(J,{title:Ye}),e("div",me,[e("div",ve,[e("div",fe,[e("div",pe,[e("div",_e,[e("div",be,[e("div",he,[e("button",{type:"button",class:"btn btn-primary mb-2 mb-lg-0",onClick:o[0]||(o[0]=t=>b.value.show("create"))},"新增專案"),e("div",ge,[F(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=t=>_.keyword=t),placeholder:"搜尋專案名稱、裝置",onKeyup:o[2]||(o[2]=K(t=>f(1),["enter"]))},null,544),[[j,_.keyword]]),e("span",we,[e("button",{class:"btn btn-primary",type:"button",onClick:o[3]||(o[3]=t=>f(1))}," 搜尋 ")])])])])])]),e("div",ye,[p(I,{header:m,items:s.value,"page-change":f,pagination:i.value},{laboratory:L(({value:t})=>[V(k(t.join("、")),1)]),action:L(({item:t})=>[e("button",{class:"btn btn-sm btn-danger",onClick:n=>b.value.show("update",t)},Ce,8,Le),$(g)().isAfter(t.startTime)?(u(),v("button",{key:0,class:"btn btn-sm btn-primary",onClick:n=>y.value.show(t.name,t.startTime)},xe,8,$e)):E("",!0),e("button",{class:"btn btn-sm btn-info",onClick:n=>w.value.show(t.name)},Me,8,Te)]),_:1},8,["items","pagination"])])])]),p(ne,{ref_key:"formModalRef",ref:b},null,512),p(ce,{ref_key:"logsModalRef",ref:y},null,512),p(ue,{ref_key:"deleteModalRef",ref:w},null,512)])],64))}};export{Ae as default};
